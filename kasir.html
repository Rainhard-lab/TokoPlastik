<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kasir</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/kasir.css">
</head>
<body>
<div class="sidebar">
  <h2>TokoPlastik</h2>
  <a href="dashboard.html">Dashboard</a>
  <a href="staff.html">Staff</a>
  <a href="inventory.html">Inventory</a>
  <a href="reports.html">Reports</a>
  <a href="kasir.html"  class="active">Kasir</a>
  <a href="login.html">Logout</a>
</div>

<div class="main">
  <div class="container-fluid">
    <h2 class="fw-bold text-primary mb-4">ðŸ›’ Kasir</h2>

    <form id="formKasir">
      <table class="table-kasir">
        <thead>
          <tr>
            <th>Produk</th>
            <th>Harga</th>
            <th>Qty</th>
            <th>Subtotal</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="keranjang"></tbody>
      </table>

      <div class="mb-3">
        <button type="button" class="btn btn-primary" onclick="tambahProduk()">+ Tambah Produk</button>
        <button type="button" class="btn btn-success" onclick="checkout()">Bayar & Cetak Struk</button>
      </div>
    </form>
  </div>
</div>

<!-- Kotak Total Sticky Bottom -->
<div class="total-transaksi">
  <h3>Total:</h3>
  <span id="totalHarga">Rp 0</span>
</div>

<script>
let produkList = [];
let keranjangDiv = document.getElementById("keranjang");
let totalHargaSpan = document.getElementById("totalHarga");

// Ambil produk dari data/produk.json
fetch("data/produk.json")
  .then(res => res.json())
  .then(data => {
    produkList = data;
  })
  .catch(err => console.error("Gagal load produk.json", err));

function formatRupiah(angka) {
  return "Rp " + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function tambahProduk() {
  let row = document.createElement("tr");
  row.innerHTML = `
    <td>
      <select name="produk[]" class="form-control" onchange="updateHarga(this)">
        <option value="">-- Pilih Produk --</option>
        ${produkList.map(p => `<option value="${p.id_produk}" data-harga="${p.harga_jual}">${p.nama_produk}</option>`).join('')}
      </select>
    </td>
    <td class="harga">Rp 0</td>
    <td><input type="number" name="jumlah[]" value="1" min="1" class="form-control" onchange="updateSubtotal(this)"></td>
    <td class="subtotal">Rp 0</td>
    <td><button type="button" class="btn btn-danger btn-sm" onclick="hapusBaris(this)">Hapus</button></td>
  `;
  keranjangDiv.appendChild(row);
}

function hapusBaris(btn) {
  btn.closest("tr").remove();
  hitungTotal();
}

function updateHarga(select) {
  let row = select.closest("tr");
  let harga = select.options[select.selectedIndex].dataset.harga || 0;
  let qty = row.querySelector("input[name='jumlah[]']").value;
  let subtotal = harga * qty;

  row.querySelector(".harga").textContent = formatRupiah(harga);
  row.querySelector(".subtotal").textContent = formatRupiah(subtotal);
  hitungTotal();
}

function updateSubtotal(input) {
  let row = input.closest("tr");
  let select = row.querySelector("select[name='produk[]']");
  updateHarga(select);
}

function hitungTotal() {
  let total = 0;
  document.querySelectorAll("#keranjang tr").forEach(tr => {
    let subtotalText = tr.querySelector(".subtotal").textContent.replace(/[^\d]/g, "");
    total += parseInt(subtotalText || 0);
  });
  totalHargaSpan.textContent = formatRupiah(total);
}

function checkout() {
  alert("Struk akan dicetak (simulasi). Total: " + totalHargaSpan.textContent);
  keranjangDiv.innerHTML = "";
  totalHargaSpan.textContent = "Rp 0";
}
</script>
</body>
</html>
